<!-- Before/After Image Slider Component -->
<!-- Usage: {% include before-after-slider.html images=page.before_after %} -->

<div class="before-after-slider" id="beforeAfterSlider">
  <div class="slider-wrapper">
    {% if include.images %}
      {% for item in include.images %}
        {% if forloop.first %}
          <img src="{{ item.before | relative_url }}" alt="Before" class="slider-img slider-img-before" id="sliderImgBefore">
          
          <div class="slider-img-after">
            <img src="{{ item.after | relative_url }}" alt="After" id="sliderImgAfter">
          </div>
          
          <div class="slider-handle" id="sliderHandle" role="slider" aria-label="Image comparison slider" tabindex="0"></div>
          
          <div class="slider-label slider-label--before">BEFORE</div>
          <div class="slider-label slider-label--after">AFTER</div>
          <div class="slider-hint">Drag to compare â†’</div>
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
</div>

<script>
(function() {
  const slider = document.getElementById('beforeAfterSlider');
  if (!slider) return;

  const wrapper = slider.querySelector('.slider-wrapper');
  const handle = slider.querySelector('.slider-handle');
  const afterImg = slider.querySelector('.slider-img-after');
  let isActive = false;

  function updateSliderPosition(e) {
    if (!isActive) return;

    const rect = wrapper.getBoundingClientRect();
    let x = e.clientX - rect.left;

    // Handle touch events
    if (e.touches) {
      x = e.touches[0].clientX - rect.left;
    }

    // Constrain x within bounds
    x = Math.max(0, Math.min(x, rect.width));

    const percentage = (x / rect.width) * 100;

    handle.style.left = percentage + '%';
    afterImg.style.width = percentage + '%';
  }

  // Mouse events
  handle.addEventListener('mousedown', () => {
    isActive = true;
  });

  document.addEventListener('mouseup', () => {
    isActive = false;
  });

  document.addEventListener('mousemove', updateSliderPosition);

  // Touch events
  handle.addEventListener('touchstart', () => {
    isActive = true;
  });

  document.addEventListener('touchend', () => {
    isActive = false;
  });

  document.addEventListener('touchmove', updateSliderPosition, { passive: true });

  // Keyboard support
  handle.addEventListener('keydown', (e) => {
    const step = 5; // percentage
    const currentLeft = parseFloat(handle.style.left || '50');

    if (e.key === 'ArrowLeft') {
      e.preventDefault();
      const newLeft = Math.max(0, currentLeft - step);
      handle.style.left = newLeft + '%';
      afterImg.style.width = newLeft + '%';
    } else if (e.key === 'ArrowRight') {
      e.preventDefault();
      const newLeft = Math.min(100, currentLeft + step);
      handle.style.left = newLeft + '%';
      afterImg.style.width = newLeft + '%';
    }
  });

  // Click on wrapper to move slider
  wrapper.addEventListener('click', (e) => {
    const rect = wrapper.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const percentage = (x / rect.width) * 100;

    handle.style.left = percentage + '%';
    afterImg.style.width = percentage + '%';
  });

  // Initialize at 50%
  handle.style.left = '50%';
  afterImg.style.width = '50%';
})();
</script>

<style>
  .before-after-slider {
    position: relative;
    width: 100%;
    margin: 2rem 0;
    overflow: hidden;
    background-color: #f5f5f5;
    border-radius: 0;
  }

  .slider-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 66.67%; /* 3:2 aspect ratio */

    img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .slider-img-before {
      width: 100%;
    }

    .slider-img-after {
      position: absolute;
      top: 0;
      left: 0;
      width: 50%;
      height: 100%;
      overflow: hidden;
    }

    .slider-handle {
      position: absolute;
      top: 0;
      left: 50%;
      width: 4px;
      height: 100%;
      background-color: #d4a373;
      cursor: col-resize;
      transform: translateX(-50%);
      z-index: 10;
      transition: opacity 0.3s ease;

      &:focus {
        outline: 2px solid #d4a373;
        outline-offset: 2px;
      }

      &::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 60px;
        height: 60px;
        background-color: #d4a373;
        border-radius: 50%;
        opacity: 0.85;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        transition: opacity 0.3s ease;
      }

      &:hover::before,
      &:focus::before {
        opacity: 1;
      }
    }
  }

  .slider-label {
    position: absolute;
    top: 1rem;
    font-size: 0.875rem;
    font-weight: 700;
    color: white;
    background-color: rgba(26, 26, 26, 0.6);
    padding: 0.75rem 1rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    z-index: 5;
    backdrop-filter: blur(2px);

    &--before {
      left: 1rem;
    }

    &--after {
      right: 1rem;
    }
  }

  .slider-hint {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.875rem;
    color: white;
    background-color: rgba(26, 26, 26, 0.6);
    padding: 0.75rem 1rem;
    text-align: center;
    z-index: 5;
    white-space: nowrap;
    backdrop-filter: blur(2px);
    animation: pulse 3s ease-in-out infinite;

    @media (max-width: 768px) {
      display: none;
    }
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 0.8;
    }
    50% {
      opacity: 1;
    }
  }
</style>
